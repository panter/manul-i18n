{"version":3,"sources":["../src/translation_container.js"],"names":["getTranslationId","children","_id","getTranslation","i18n","doc","disableEditorBypass","params","translationId","tDoc","t","getTranslationProps","context","gotoEdit","props","locale","getLocale","translation","isEditMode","composer","onData","depsMapper","actions","editTranslationAction","Component","_tagType","_props","editorProps","style","cursor","textTransform","onClick","e","preventDefault","createElement","dangerouslySetInnerHTML","__html","key","displayName","composeWithTrackerServerSave","global","T","stubContext","translationStore","setLocale","translate","supportedLocales","defaultLocale"],"mappings":"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","file":"translation_container.js","sourcesContent":["import React from 'react';\nimport { get, noop, isString, isFunction, invokeArgs } from 'lodash/fp';\nimport { pure } from 'recompose';\nimport { useDeps, composeAll, composeWithTracker, compose } from 'mantra-core';\nimport { setComposerStub } from 'react-komposer';\nimport I18nService from './i18n_service';\n\n\n/**\n\n                 MR T\n\n                 `sdddh-\n                +MMMMMy\n                -ddddh+\n                           :+\n          +N/             /MN\n          :M.              ms\n           d               s+\n           y`              s/\n           :/     ``      .N:\n            o+-+hmdhhddy-:mM`\n             hMM+     .dMMMy\n             `dMm-:ss.-NMNo\n               +mMNNNmMNo`\n                 .+sys:\n\n      \"The jibba jabba stops here!\"\n\n\n  Mr. T translates your stuff:\n\n  translate single key from the translation store (will render as <span>)\n  <T>home.content.title</T>\n\n  If you can't use react-node, but need a plan string, pass a function as child:\n  <T _id=\"home.content.image.alttext\">{(altText) => <img alt={altText} src=\"...\" />}</T>\n\n  MR. T can also pick properites from objects/documents by path.\n  E.g. this reads the object page.meta.title.<current locale>\n  <T doc={page} >meta.title</T>\n\n  also works with function-children:\n  <T doc={page} _id=\"meta.title\">{(altText) => <img alt={altText} src=\"...\" />}</T>\n\n  If you have simple object with keys as locales, e.g.\n  const myProperty = {\n    de: \"German\",\n    fr: \"French\",\n    it: \"English\"\n  }\n\n  you can also use Mr. T to display the right translation (empty path)\n\n  <T doc={myProperty} />\n\n  Advanced:\n  ---------\n\n  If i18n isEditMode() returns true (reactivly),\n  it will render the key instead of the translation (does not work for doc-paths currently).\n\n  pass property disableEditorBypass to disable this feature on a <T>:\n  <T disableEditorBypass>path.to.key</T>\n\n  if i18n-service provides a editTranslationAction and i18n isEditMode() is true\n  a click on <T> will call this function / mantra-action\n\n  inspired by https://github.com/vazco/meteor-universe-i18n\n  Â© Panter 2016\n\n**/\n\nconst getTranslationId = ({ children, _id }) => (\n  _id || (isString(children) ? children : null)\n);\n\nconst getTranslation = (i18n, { doc, _id, disableEditorBypass, children, ...params }) => {\n  const translationId = getTranslationId({ children, _id });\n  if (doc) {\n    return i18n.tDoc(doc, translationId);\n  }\n  return i18n.t(translationId, params, { disableEditorBypass });\n};\n\n/**\nthis function is outside of the composer so that it can be used in stubbing mode more easily\n**/\nconst getTranslationProps = (context, { gotoEdit, ...props }) => {\n  const { i18n } = context();\n  const locale = i18n.getLocale();\n  const translationId = getTranslationId(props);\n  const translation = getTranslation(i18n, props);\n\n  let isEditMode = i18n.isEditMode();\n\n  if (props.doc) {\n    // no edit mode highlighting for docs yet and no gotoEdit;\n    /* eslint no-param-reassign: 0*/\n    gotoEdit = noop;\n    isEditMode = false;\n  }\n  return { translationId, gotoEdit, translation, locale, isEditMode };\n};\n\nexport const composer = ({ context, ...props }, onData) => {\n  onData(null, getTranslationProps(context, props));\n};\n\nexport const depsMapper = (context, actions) => ({\n  gotoEdit: (translationId) => {\n    if (isFunction(context.i18n.editTranslationAction)) {\n      // call function\n      context.i18n.editTranslationAction(translationId);\n    } else if (isString(context.i18n.editTranslationAction)) {\n      // call mantra action\n      invokeArgs(context.i18n.editTranslationAction, [translationId], actions);\n    }\n  },\n  context: () => context,\n});\n\nconst Component = (\n  { isEditMode, gotoEdit, translationId, locale, _tagType, _props = {}, translation, children },\n) => {\n  if (isFunction(children)) {\n    return children(translation);\n  }\n  const editorProps = {\n    style: {\n      cursor: isEditMode && 'pointer',\n      textTransform: isEditMode && 'none',\n    },\n    onClick: (e) => {\n      if (isEditMode && gotoEdit) {\n        e.preventDefault();\n        gotoEdit(translationId);\n      }\n    },\n  };\n  return React.createElement(_tagType || 'span', {\n    ..._props,\n    ...editorProps,\n    dangerouslySetInnerHTML: {\n      __html: translation,\n    },\n    key: locale,\n  });\n};\n\nComponent.displayName = 'T';\n\nconst composeWithTrackerServerSave = get('Meteor.isServer', global) ? compose : composeWithTracker;\nconst T = composeAll(\n  composeWithTrackerServerSave(composer),\n  useDeps(depsMapper),\n  pure,\n)(Component);\n\nT.displayName = 'T';\n\nsetComposerStub(T, (props) => {\n  const stubContext = () => ({\n    i18n: new I18nService({\n      translationStore: {\n        setLocale: noop,\n        getLocale: () => 'de',\n        translate: key => key,\n      },\n      supportedLocales: ['de'],\n      defaultLocale: 'de',\n    }),\n  });\n  return getTranslationProps(stubContext, props);\n});\n\nexport default T;\n"]}