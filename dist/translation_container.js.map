{"version":3,"sources":["../src/translation_container.js"],"names":[],"mappings":"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","file":"translation_container.js","sourcesContent":["import React from 'react';\nimport _ from 'lodash';\nimport { useDeps, composeAll, composeWithTracker, compose } from 'mantra-core';\nimport { setComposerStub } from 'react-komposer';\nimport I18nService from './i18n_service';\n\n/**\n\n                 MR T\n\n                 `sdddh-\n                +MMMMMy\n                -ddddh+\n                           :+\n          +N/             /MN\n          :M.              ms\n           d               s+\n           y`              s/\n           :/     ``      .N:\n            o+-+hmdhhddy-:mM`\n             hMM+     .dMMMy\n             `dMm-:ss.-NMNo\n               +mMNNNmMNo`\n                 .+sys:\n\n      \"The jibba jabba stops here!\"\n\n\n  Mr. T translates your stuff:\n\n  translate single key from the translation store (will render as <span>)\n  <T>home.content.title</T>\n\n  If you can't use react-node, but need a plan string, pass a function as child:\n  <T _id=\"home.content.image.alttext\">{(altText) => <img alt={altText} src=\"...\" />}</T>\n\n  MR. T can also pick properites from objects/documents by path.\n  E.g. this reads the object page.meta.title.<current locale>\n  <T doc={page} >meta.title</T>\n\n  also works with function-children:\n  <T doc={page} _id=\"meta.title\">{(altText) => <img alt={altText} src=\"...\" />}</T>\n\n  If you have simple object with keys as locales, e.g.\n  const myProperty = {\n    de: \"German\",\n    fr: \"French\",\n    it: \"English\"\n  }\n\n  you can also use Mr. T to display the right translation (empty path)\n\n  <T doc={myProperty} />\n\n  Advanced:\n  ---------\n\n  If i18n isEditMode() returns true (reactivly),\n  it will render the key instead of the translation (does not work for doc-paths currently).\n\n  pass property disableEditorBypass to disable this feature on a <T>:\n  <T disableEditorBypass>path.to.key</T>\n\n  if i18n-service provides a editTranslationAction and i18n isEditMode() is true\n  a click on <T> will call this function / mantra-action\n\n  inspired by https://github.com/vazco/meteor-universe-i18n\n  Â© Panter 2016\n\n**/\n\nconst getTranslationId = ({ children, _id }) => (\n  _id || (_.isString(children) ? children : null)\n);\n\nconst getTranslation = (i18n, { doc, _id, disableEditorBypass, children, ...params }) => {\n  const translationId = getTranslationId({ children, _id });\n  if (doc) {\n    return i18n.tDoc(doc, translationId);\n  }\n  return i18n.t(translationId, params, { disableEditorBypass });\n};\n\n/**\nthis function is outside of the composer so that it can be used in stubbing mode more easily\n**/\nconst getTranslationProps = (context, props) => {\n  const { i18n } = context();\n  const locale = i18n.getLocale();\n  const translationId = getTranslationId(props);\n  const translation = getTranslation(i18n, props);\n\n  let isEditMode = i18n.isEditMode();\n  let gotoEdit = () => {\n    if (_.isFunction(i18n.editTranslationAction)) {\n      // call function\n      i18n.editTranslationAction(translationId);\n    } else if (_.isString(i18n.editTranslationAction)) {\n      // call mantra action\n      _.invoke(props.actions, i18n.editTranslationAction, translationId);\n    }\n  };\n  if (props.doc) {\n      // no edit mode highlighting for docs yet and no gotoEdit;\n    gotoEdit = _.noop;\n    isEditMode = false;\n  }\n  return { translationId, gotoEdit, translation, locale, isEditMode };\n};\n\n\nexport const composer = ({ context, ...props }, onData) => {\n  onData(null, getTranslationProps(context, props));\n};\nexport const depsMapper = (context, actions) => ({\n  context: () => context,\n  actions,\n});\n\nconst Component = (\n  { isEditMode, gotoEdit, locale, _tagType, _props = {}, translation, children },\n) => {\n  if (_.isFunction(children)) {\n    return children(translation);\n  }\n  const editorProps = {\n    style: {\n      cursor: isEditMode && 'pointer',\n      textTransform: isEditMode && 'none',\n    },\n    onClick: () => (isEditMode && gotoEdit ? gotoEdit() : null),\n  };\n  return React.createElement(_tagType || 'span', {\n    ..._props,\n    ...editorProps,\n    dangerouslySetInnerHTML: {\n      __html: translation,\n    },\n    key: locale,\n  });\n};\n\nComponent.displayName = 'T';\n\nconst composeWithTrackerServerSave = _.get(global, 'Meteor.isServer') ? compose : composeWithTracker;\nconst T = composeAll(\n  composeWithTrackerServerSave(composer),\n  useDeps(depsMapper),\n)(Component);\n\nT.displayName = 'T';\n\nsetComposerStub(T, (props) => {\n  const stubContext = () => ({\n    i18n: new I18nService({\n      translationStore: {\n        setLocale: _.noop,\n        getLocale: () => 'de',\n        translate: key => key,\n      },\n      supportedLocales: ['de'],\n      defaultLocale: 'de',\n    }),\n  });\n  return getTranslationProps(stubContext, props);\n});\n\nexport default T;\n"]}